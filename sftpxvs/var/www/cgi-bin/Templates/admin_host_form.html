<script>
  loadT('Host Form');
</script>

<div class="block admin-settings p-0">

<Form method="POST" onSubmit="return checkForm(this)">
  <input type="hidden" name="op" value="admin_host_save">
  <input type="hidden" name="token" value="<TMPL_VAR token>">
  <input type="hidden" name="host_id" value="<TMPL_VAR host_id>">
  <table class="table settings-table mb-0 align-middle">
    <tbody>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">Host name</label></td>
        <td class="border-start">
          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <input type="text" name="host_name" value="<TMPL_VAR host_name>" class="form-control form-control-sm">
            </div>
            <div class="col-auto">
              <TMPL_IF host_id><a class="btn btn-danger btn-sm" href="?op=admin_host_edit&host_id=<TMPL_VAR host_id>&del=1<TMPL_VAR token_str>" onclick="return confirm('Delete this Host?')">Delete Host</a></TMPL_IF>
            </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">files URL</label></td>
        <td class="border-start"><input type="text" name="host_htdocs_url" value="<TMPL_VAR host_htdocs_url>" class="form-control form-control-sm"></td>
      </tr>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">cgi-bin URL</label></td>
        <td class="border-start"><input type="text" name="host_cgi_url" value="<TMPL_VAR host_cgi_url>" class="form-control form-control-sm"></td>
      </tr>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">IP</label></td>
        <td class="border-start"><input type="text" name="host_ip" value="<TMPL_VAR host_ip>" class="form-control form-control-sm"></td>
      </tr>
      <tr class="<TMPL_UNLESS host_id>inv </TMPL_UNLESS>hostinfoblock">
          <td class="bg-light"></td>
        <td class="bg-light" id="hostinfo"><input type="button" class="btn btn-primary btn-sm" value="Get host info"
            onclick="$(this).hide();$.post('<TMPL_VAR site_url>/adm',{op:'admin_host_edit',token:'<TMPL_VAR token>',get_host_info:'1',host_cgi_url:$('input[name=host_cgi_url]').val()},function(data){$('#hostinfo').html(data)} );"></td>
      </tr>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">Encoder processes</label></td>
        <td class="border-start">
          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <select class="form-select" name="host_max_enc">
                <option<TMPL_VAR epr0>>0</option>
                  <option<TMPL_VAR epr1>>1</option>
                    <option<TMPL_VAR epr2>>2</option>
                      <option<TMPL_VAR epr3>>3</option>
                        <option<TMPL_VAR epr4>>4</option>
                          <option<TMPL_VAR epr6>>6</option>
                            <option<TMPL_VAR epr8>>8</option>
              </select>
            </div>
            <div class="col-auto"> per server </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">Transfer processes</label></td>
        <td class="border-start">
          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <select class="form-select" name="host_max_trans">
                <option<TMPL_VAR trans0>>0</option>
                  <option<TMPL_VAR trans1>>1</option>
                    <option<TMPL_VAR trans2>>2</option>
                      <option<TMPL_VAR trans3>>3</option>
                        <option<TMPL_VAR trans4>>4</option>
                          <option<TMPL_VAR trans6>>6</option>
                            <option<TMPL_VAR trans8>>8</option>
              </select>
            </div>
            <div class="col-auto"> per server </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">URL Upload processes</label></td>
        <td class="border-start">
          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <select class="form-select" name="host_max_url">
                <option<TMPL_VAR url0>>0</option>
                  <option<TMPL_VAR url1>>1</option>
                    <option<TMPL_VAR url2>>2</option>
                      <option<TMPL_VAR url3>>3</option>
                        <option<TMPL_VAR url4>>4</option>
                          <option<TMPL_VAR url6>>6</option>
                            <option<TMPL_VAR url8>>8</option>
              </select>
            </div>
            <div class="col-auto"> per server </div>
          </div>
        </td>
      </tr>
      <TMPL_IF m_t>
        <tr>
          <td class="text-lg-end"><label class="col-form-label">Torrent engine</label></td>
          <td class="border-start"><label class="form-switcher"><input type="checkbox" name="host_torrent" value="1" <TMPL_IF host_torrent> checked</TMPL_IF>></label></td>
      </tr>
      </TMPL_IF>
      <TMPL_IF m_f>
        <tr>
          <td class="text-lg-end"><label class="col-form-label">FTP Server</label></td>
          <td class="border-start"><label class="form-switcher"><input type="checkbox" name="host_ftp" value="1"<TMPL_IF host_ftp> checked</TMPL_IF>></label></td>
      </tr>
      </TMPL_IF>
	<TMPL_IF m_r>
	<tr>
		<td class="text-lg-end"><label class="col-form-label">HLS Proxy Server</label></td>
		<td class="border-start"><label class="form-switcher"><input type="checkbox" name="host_proxy" value="1"<TMPL_IF host_proxy> checked</TMPL_IF>></label></td>
	</tr>
	<TMPL_IF host_proxy>
	<tr>
		<td class="text-lg-end"><label class="col-form-label">Special users Proxy only</label></td>
		<td class="border-start"><input type="text" name="host_proxy_users_only" value="<TMPL_VAR host_proxy_users_only>" size=32 class="form-control" style="display: inline;"> (e.g. 1,5,37)</td>
	</tr>
	</TMPL_IF>
	</TMPL_IF>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">Transfer speed</label></td>
        <td class="border-start">
          <div class="row g-3 align-items-center">
            <div class="col-auto">
              <div class="input-group input-group-sm">
                <input type="text" name="host_transfer_speed" value="<TMPL_VAR host_transfer_speed>" class="form-control" maxlength="5" style="max-width:100px">
                <span class="input-group-text">KB/s</span>
              </div>
            </div>
            <div class="col-auto"> , receiving speed, 0 for default </div>
          </div>
        </td>
      </tr>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">Network speed</label></td>
        <td class="border-start">
          <div class="input-group input-group-sm">
            <input type="text" name="host_net_speed" value="<TMPL_VAR host_net_speed>" class="form-control" maxlength="5" style="max-width:100px">
            <span class="input-group-text">Mbps</span>
          </div>
        </td>
      </tr>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">Make tests</label></td>
        <td class="border-start"><label class="form-switcher"><input type="checkbox" name="util_test" value="1" checked> <small class="text-muted">Test ffmpeg+atop+iostat+convert</small></label></td>
      </tr>
      <TMPL_IF m_q>
        <tr>
          <td class="text-lg-end"><label class="col-form-label">Live streaming</label></td>
          <td class="border-start"><label class="form-switcher"><input type="checkbox" name="host_live" value="1" <TMPL_IF host_live> checked
      </TMPL_IF>></label></td>
      </tr>
      </TMPL_IF>
      <tr>
        <td class="text-lg-end"><label class="col-form-label">Notes</label></td>
        <td class="border-start"><textarea name="host_notes" rows="2" class="form-control form-control-sm""><TMPL_VAR host_notes></textarea></td>
</tr>

<TMPL_IF tests>
<tr>
  <td class=" text-lg-end"></td>
<td class="border-start">
<b>Host tests:</b><br>
<TMPL_LOOP tests>
<div class="<TMPL_VAR class>"><TMPL_VAR text></div>
</TMPL_LOOP>
</td></tr>
</TMPL_IF>

</tbody>
</table>

<div class="p-3 text-center">
	<input type="submit" name="save" value="Save" class="btn btn-primary submit-btn">
</div>


</div>

</Form>

<Script>
function checkForm(f1)
{
    if(f1.host_name.value.length<2){alert("Enter host name at least 2 chars");return false;}
    if(f1.host_cgi_url.value.length<5){alert("Enter valid cgi-bin URL");return false;}
    if(f1.host_htdocs_url.value.length<5){alert("Enter valid files URL");return false;}
    return true;
}
$("input[name=host_htdocs_url]").blur(function (){
	var url = $("input[name=host_htdocs_url]").val().replace(/\/$/, "");;
	if(url && !$("input[name=host_cgi_url]").val())
	{
		$("input[name=host_cgi_url]").val(url+'/cgi-bin');
		$("input[name=host_htdocs_url]").val(url);
		if(url.match(/\/\/(\w+)\./)) $("input[name=host_name]").val(RegExp.$1.toUpperCase());
		$("input[name=host_ip]").focus();
		$(".hostinfoblock").show();
	}
});
$("input[name=host_cgi_url]").change(function (){
	$(".hostinfoblock").show();
});
<TMPL_UNLESS host_id>$("input[name=host_htdocs_url]").focus();</TMPL_UNLESS>
</Script>
