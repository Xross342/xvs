<script>
	loadT('<TMPL_VAR lng_myreports_title>');
</script>
<div class="top-bar">
  <div class="row align-items-center g-3">
    <div class="col-auto">
      <Form>
      <input type="hidden" name="op" value="my_reports">
      <div class="row g-2 align-items-center">
        <div class="col-auto">
          <input type="text" class="form-select date" name="date1" value="<TMPL_VAR date1>" style="max-width: 150px;">
        </div>
        <div class="col-auto">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="1" fill="none">
            <path stroke="#7E879D" d="M0 .5h14"></path>
          </svg>
        </div>
        <div class="col-auto">
          <input type="text" class="form-select date"  name="date2" value="<TMPL_VAR date2>" style="max-width: 150px;">
        </div>
        <div class="col-auto">
          <button type="submit" name="show" class="btn btn-primary"><TMPL_VAR lng_myreports_show></button>
        </div>
      </div>
      </form>
    </div>
  </div>
</div>

<div class="block">
	<TMPL_IF list>
	<div id="reports" style="width: 100%;height:420px"></div>
	<TMPL_ELSE>
		<div class="p-4">
			No earnings for selected period
		</div>
	</TMPL_IF>
</div>


<script src="<TMPL_VAR static_url>/js/jquery.flot.min.js"></script>
<script src="<TMPL_VAR static_url>/js/jquery.flot.time.min.js"></script>
    <script>
    $(function() {

        var data_views = [<TMPL_LOOP list>['<TMPL_VAR time>','<TMPL_VAR profit_views>']<TMPL_UNLESS __last__>,</TMPL_UNLESS></TMPL_LOOP>];
        var data_sales = [<TMPL_LOOP list>['<TMPL_VAR time>','<TMPL_VAR profit_sales>']<TMPL_UNLESS __last__>,</TMPL_UNLESS></TMPL_LOOP>];
        var data_refs  = [<TMPL_LOOP list>['<TMPL_VAR time>','<TMPL_VAR profit_refs>']<TMPL_UNLESS __last__>,</TMPL_UNLESS></TMPL_LOOP>];

        $.plot("#reports", [ {data:data_views,label:"Views"},{data:data_sales,label:"Sales"},{data:data_refs,label:"Referrals"} ], {
            series: {
                lines: {show: true},
                points: {show: true},
                shadowSize: 0,
            },
            grid: {
              borderWidth: 1,
                hoverable: true,
                clickable: true,
                  borderColor: "#C9CED5",
            },
            yaxis: {tickDecimals: 2},
            xaxis: {
                mode: "time",
                tickLength: 5
            },
            legend: {
              noColumns: 3,
              labelBoxBorderColor: 'transparent',
              margin: [5, 5],
            },
            colors: ["#3586FF", "#4E5567", "#1E9754"]
        });



        $("<div id='tooltip' style='margin-top:-33px;border-radius:3px'></div>").css({
            position: "absolute",
            display: "none",
            padding: "2px 8px",
            "background-color": "rgba(0,0,0,.65)",
            "color": "#fff",
            "font-size": ".75rem",
            opacity: 1
        }).appendTo("body");

        $("#reports").bind("plothover", function (event, pos, item)
        {
                if (item) {
                    var x = item.datapoint[0];
                        y = item.datapoint[1];
                    var d = new Date(x);
                    dt = d.toJSON().substring(0,10);
                    $("#tooltip").html(item.series.label + ': ' + dt + " = " + y)
                        .css({top: item.pageY+5, left: item.pageX+5})
                        .fadeIn(200);
                } else {
                    $("#tooltip").hide();
                }
        });
    });

        function weekendAreas(axes) {

            var markings = [],
                d = new Date(axes.xaxis.min);

            // go to the first Saturday

            d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 1) % 7))
            d.setUTCSeconds(0);
            d.setUTCMinutes(0);
            d.setUTCHours(0);

            var i = d.getTime();

            do {
                markings.push({ xaxis: { from: i, to: i + 2 * 24 * 60 * 60 * 1000 } });
                i += 7 * 24 * 60 * 60 * 1000;
            } while (i < axes.xaxis.max);

            return markings;
        }

    </script>



<div class="table-responsive mb-4">
	<table class="table table-rounded table-justify">
		<thead>
			<tr>
        <th class="text-start"><TMPL_VAR lng_myreports_date></th>
        <th><TMPL_VAR lng_myreports_views></th>
        <th>Views Prem</th>
        <th>Views ADB</th>
        <th>Views Profit</th>
        <th><TMPL_VAR lng_myreports_premium_sales></th>
        <th><TMPL_VAR lng_myreports_referrals></th>
        <TMPL_IF m_b><th><TMPL_VAR lng_myreports_website></th></TMPL_IF>
        <th><TMPL_VAR lng_myreports_downloads></th>
        <th>Refs</th>
        <th class="text-end"><TMPL_VAR lng_myreports_total></th>
			</tr>
		</thead>
		<tbody>
			<TMPL_LOOP list>
        <tr>
          <td class="text-start"><TMPL_VAR day></td>
          <td><a href="/?op=my_reports_day&amp;day=<TMPL_VAR day>"><TMPL_VAR views></a></td>
          <td><TMPL_VAR views_prem></td>
          <td><TMPL_VAR views_adb></td>
          <td>$<TMPL_VAR profit_views></td>
          <td><TMPL_VAR sales> / $<TMPL_VAR profit_sales></td>
          <td>$<TMPL_VAR profit_refs></td>
          <TMPL_IF m_b><td>$<TMPL_VAR profit_site></td></TMPL_IF>
          <td><TMPL_VAR downloads></td>
          <td><TMPL_VAR refs></td>
          <td class="text-end">$<TMPL_VAR profit_total></td>
        </tr>
			</TMPL_LOOP>
		</tbody>
		<tfoot>
			<tr>
        <td class="text-start"></td>
        <td><TMPL_VAR sum_views></td>
        <td><TMPL_VAR sum_views_prem></td>
        <td><TMPL_VAR sum_views_adb></td>
        <td>$<TMPL_VAR sum_profit_views></td>
        <td><TMPL_VAR sum_sales> / $<TMPL_VAR sum_profit_sales></td>
        <td>$<TMPL_VAR sum_profit_refs></td>
        <TMPL_IF m_b><td>$<TMPL_VAR sum_profit_site></td></TMPL_IF>
        <td><TMPL_VAR sum_downloads></td>
        <td><TMPL_VAR sum_refs></td>
        <td class="text-end">$<TMPL_VAR sum_profit_total></td>
			</tr>
		</tfoot>
	</table>
</div>

<link href="<TMPL_VAR site_url>/css/jquery-ui.css" rel="stylesheet"/>
<script src="<TMPL_VAR site_url>/js/jquery-ui.js"></script>
<script>
    $('.date').datepicker({
        dateFormat: 'yy-mm-dd',
    });
</script>
<style media="screen">
  #ui-datepicker-div {
    z-index: 101 !important;
  }
</style>
