!function(){"use strict";const t="freewheel",e="playing",s="external",i=s,n="time",r="__jwpseg__",o="instream",a="article",l={[[o]]:1,[["banner"]]:2,[[a]]:3,[["feed"]]:4,[["floating"]]:5,[["interstitial"]]:5,[["slider"]]:5},d="adError",h="adBreakStart",c="adBreakEnd",u="adSkipped",p="jw-flag-ads-vpaid",g="jw-flag-ads-freewheel",m="jw-freewheel-before-impression",f=(t,e)=>({begin:t._offSet,text:e,cueType:"ads",adId:t.adBreakId});class y{constructor(t,e,s,i){this.client=i,this.player=t,this.pluginConfig=e,this.div=s,this.utils=this.player.utils,this.playerConfig=this.player.getConfig(),this.playlistItemManager=null,this.playerKey=this.playerConfig.key,this.casting=!1,this.player.pauseAd=this.pauseAd.bind(this),this.player.skipAd=this.skipAd.bind(this),this.player.skipAdBreak=this.skipAdBreak.bind(this),this.destroyAdsManager=this.destroyAdsManager.bind(this),this.handleDependencyError=this.handleDependencyError.bind(this),this.sendCues=this.sendCues.bind(this)}lateInitAfterReady(){this.onReady();const t=this.player.getPlaylistItem();t&&this.onPlaylistItemCallback({item:t,index:this.player.getPlaylistIndex()})}onReady(){throw new Error("Not implemented.")}onPlaylistItemCallback(){throw new Error("Not implemented.")}destroyAdsManager(){this.playlistItemManager&&(this.playlistItemManager.destroy(),this.playlistItemManager=null)}handleDependencyError(e,s){this.destroyAdsManager(),this.player.off(null,null,this),this.client===t&&(this.player.playAd=this.utils.noop),this.player.trigger(d,{id:"-1",client:this.client,message:e,code:900,adErrorCode:s,tag:""})}pauseAd(t,e=null){this.playlistItemManager&&(t?this.playlistItemManager.pause(e||{}):this.playlistItemManager.resume(e||{}))}skipAd(){var t;null!=this&&null!=(t=this.playlistItemManager)&&t.skipAd&&this.playlistItemManager.skipAd()}skipAdBreak(){var t;null!=this&&null!=(t=this.playlistItemManager)&&t.skipAdBreak&&this.playlistItemManager.skipAdBreak()}sendCues(t,e){const s=t.getMidRolls(),i=[];t.preRoll&&i.push(f(t.preRoll,e)),s.length&&s.forEach((t=>{"nonlinear"!==t._type&&i.push(f(t,e))})),t.postRoll&&i.push(f(t.postRoll,e)),this.player.addCues(i)}resetCues(){const t=this.player.getCues().filter((t=>"ads"!==t.cueType));this.player.setCues(t)}}const _=function(t,e,s,i){if(0!==i.indexOf(t))return!1;const n=parseFloat(i.slice(t.length));return!(n<e||n>s)&&n},E=_.bind(null,"800000",10,90),A=_.bind(null,"900000",10,90),I=_.bind(null,"JWIAB",1,999),v=/^[^:/?#]+:?\/\/[^/?#]+/,w=t=>t?new URL(t).hostname:"",C=(t,e=document.location.search)=>{if(t)return new URLSearchParams(e).getAll(t)},T=/^(https?:\/\/).*.(?:ampproject.org|bing-amp.com)\/(?:.\/)*(.*)\/amp.*$/,P=function(){if(!((t,e)=>{if(t)return new URLSearchParams(t).has(e)})(document.location.search,"isAMP"))return;const t=C("consentValue").join(),e=C("consentGdpr").join();return t||e?{gdprApplies:e,consentData:t}:void 0},b=Date.now||function(){return(new Date).getTime()},L=t=>{const e=(t=>{let e=window;for(;e;){try{if(e.frames[t])break}catch(t){}e=e===window.top?null:e.parent}return e})(`${t}Locator`);return null!==e&&function(s,i,n,r){const o=b(),a=e=>{let s=e?e.data:{};if("string"==typeof s)try{s=JSON.parse(s)}catch(t){s={}}const i=`${t}Return`;s[i]&&s[i].callId===o&&(removeEventListener("message",a),n(s[i].returnValue,s[i].success))};window.addEventListener("message",a,!1);const l={[[`${t}Call`]]:{command:s,callId:o,parameter:r,[[void 0!==r?"version":"parameter"]]:i}};e.postMessage(JSON.stringify(l),"*")}};let S=null,k={gdprApplies:!0,consentData:""};const O=function(t){const e=t.advertising;if(null!=e&&e.placement){const t=e.placement.toLowerCase();if(l[t])return l[t]}return l[null!=e&&e.outstream?a:o]},M=function(){const t=(e=document.referrer)&&null!==e.match(v)?function(t){const e=t.match(T);return e&&e.length>1?`${e[1]}${e[2]}`:t}(document.referrer):"";var e;if(window.top!==window.self){try{return{url:window.top.location.href,domain:window.top.document.domain,referrer:t}}catch(t){}return{url:t,domain:w(t),referrer:""}}return{url:document.location.href,domain:document.domain,referrer:t}},R=function(t,e,s=!0){if("start"===t||"0%"===t||s&&!t&&0!==t)return"pre";if("end"===t||"100%"===t)return"post";if("string"==typeof t&&("pre"===t||"post"===t||t.indexOf("%")>=0))return t;const i=e.seconds(t);return"number"==typeof i&&!isNaN(i)&&i},j=function(t,e){const s=t.getPlugin("inference"),i=e.jwpseg_client_side,n=e.jwpseg||[];let r;if(!i||!i.length||!s)return n;try{r=s.predict(i,e)}catch(t){return e.jwpseg||[]}return[...Object.keys(r).filter((t=>r[t])),...n.filter((t=>-1===i.indexOf(t)))]},x=t=>{if("true"===t)return!0;if("false"===t)return!1;const e=parseFloat(t);return isNaN(e)?t:e},D=(t,e=!1)=>{const s=e?0===t.getPosition()&&"idle"===t.getState():0===t.getPosition();return t.isBeforePlay()||s?"pre":t.isBeforeComplete()||t.getPosition()===t.getDuration()?"post":"mid"};var N=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)};class V{constructor(t,e,s){this.config=t,this.setOptions(s),this.setLocalizationOptions(e)}setLocalizationOptions(t){for(const e in t)e&&"string"==typeof e&&(this[e]=t[e])}setOptions(t,e=!1){for(const s in t)if(N(t,s)){let i=e?this.config[s]||this.config[s.toLowerCase()]:this.config[s];const n=t[s],r=typeof n;if(void 0!==i){if("boolean"!==r&&"number"!==r||(i=x(i)),typeof i!==r)throw new Error(`invalid parameter: ${s} should be a ${r}`);this[s]=i}else this[s]=n}}}class B extends V{constructor(t,e,s){var i,n,r,o;const a=e.localization.advertising,{admessage:l,podmessage:d,cuetext:h,loadingAd:c,skipmessage:u,skiptext:p}=a;super(t,{admessage:l,podmessage:d,cuetext:h,loadingAd:c,skipmessage:u,skiptext:p},{debug:!1,admessagedynamickey:/(\b)xx(s?\b)/g,loadVideoTimeout:15e3,requestTimeout:15e3,adBlockTimeout:4e3}),this.admessagedynamic=this.admessage,this.fwassetid=s.fwassetid||e.fwassetid,this.duration=s.duration||e.duration||0,this.adschedule=s.adschedule||null;const g=s.freewheel||{},m=this.config.freewheel||{};this.profileid=g.profileid||m.profileid,this.sectionid=g.sectionid||m.sectionid,this.networkid=g.networkid||m.networkid,this.serverid=g.serverid||m.serverid,this.afid=g.afid||m.afid,this.sfid=g.sfid||m.sfid,this.vcid=g.vcid||m.vcid,this.capabilities={flag:{},metr:{}},null!=g&&null!=(i=g.capabilities)&&i.flag?this.capabilities.flag=g.capabilities.flag:null!=m&&null!=(n=m.capabilities)&&n.flag&&(this.capabilities.flag=m.capabilities.flag),null!=g&&null!=(r=g.capabilities)&&r.metr?this.capabilities.metr=g.capabilities.metr:null!=m&&null!=(o=m.capabilities)&&o.metr&&(this.capabilities.metr=m.capabilities.metr),this.custom=g.custom||m.custom||{}}setOptions(t){return super.setOptions(t,!0)}getSchedule(){const t=this.config;return this.adschedule||t.tag||t.schedule||t.ad}getAdRules(){const t=this.config.rules||{},e=parseInt(t.frequency,10);return{startOn:t.startOn||1,frequency:isNaN(e)?1:e}}}const U={};const $="6.43.0",q=`http://adm.fwmrm.net/libs/adm/${$}/AdManager.js`,F=`https://mssl.fwmrm.net/libs/adm/${$}/AdManager.js`;let Y=null;function K(t,e=null){var s,i;if(!Y&&null!=(s=window)&&null!=(i=s.tv)&&i.freewheel&&(Y=Promise.resolve()),Y)return Y;const{protocol:n}=document.location;return Y=function(t,e){if(U[e])return U[e];"file:"===document.location.protocol&&0===e.indexOf("//")&&(e=`https:${e}`);const s=new(0,t.scriptloader)(e);return U[e]=s.load(),U[e]}(t,e||("file:"===n||"https:"===n?F:q)),Y}const G={},z={},W=(t,e,s)=>{const i=z[e];return i||(z[e]=((t,e)=>{const s=G[e];return s||(G[e]=new Promise(((s,i)=>{const n=new t.key(e);if("unlimited"===n.edition())return i();const r=["//","entitlements.jwplayer.com","/",n.token(),".json"];"file:"===window.location.protocol&&r.unshift("https:"),t.ajax(r.join(""),(function(t){const e=null==t?void 0:t.response;e?s(e):i()}),(function(){i()}),{timeout:1e4,responseType:"json"})})))})(t,e).catch((()=>({}))).then((t=>{let e,i;if(!0===s.outstream?(e=!1!==t.canPlayOutstreamAds,i="Outstream Ad Limit Reached"):(e=!1!==t.canPlayAds,i="Ad Limit Reached"),!1===e)throw new Error(i);return{message:"Can Play Ads"}})))};class H{constructor(t,e){t.extend(this,e),this.isMuted=!1,this.vol=0,this.freewheelProxy=null}setProxy(t){this.freewheelProxy=t,this.mute(this.isMuted)}attachMedia(){}detachMedia(){}mute(t){this.isMuted=t,this.freewheelProxy&&this.freewheelProxy.setAdVolume(this.isMuted?0:this.vol)}volume(t){this.vol=t/100,this.freewheelProxy&&this.freewheelProxy.setAdVolume(this.vol)}setFullscreen(t){if(this.video){if(t)try{const t=this.video.webkitEnterFullscreen;t&&t.apply(this.video)}catch(t){return!1}else{const t=this.video.webkitExitFullscreen;t&&t.apply(this.video)}return Boolean(t)}}}var J="2.2.17",Q=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)};const X=/^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/,Z=function(t,e,s){return t.replace(e,s)},tt=function(t,e){const s=Math.pow(10,e);return Math.round(t*s)/s},et=function(e,s,i,n,o,a={}){var l,d,h,c,u,p,g;if(!e)return e;const m=function(t,e){const s=t.getConfig(),i=t.getPlaylistItem()===e,n={playerHeight:t.getHeight()||s.height||"",playerWidth:t.getWidth()||s.width||"",itemDuration:i&&tt(t.getDuration(),3)||"",integerDuration:i&&tt(e.duration,0)||"",item:e,jwpseg:j(t,e),placement:O(s),userAgent:navigator.userAgent},r=s.advertising?s.advertising.ampMacros:{};return Object.assign(n,r)}(s,i),f=M();let y=null;null!=i&&i.jwpseg&&(y=function(t){const e=[],s=[],i=[],n=[];for(let r of t){"string"!=typeof r&&(r=String(r));const t=E(r);if(t){e.push(t);continue}const o=A(r);if(o){s.push(o);continue}const a=I(r);a?i.push(a):"JWBRSAFE"===r&&n.push(1)}return e.length||s.length||i.length||n.length?{hb_jwvb:e,hb_jwcr:s,hb_jwiab:i,hb_jwbs:n}:null}(i.jwpseg));const _={viewability:(null==(l=y)||null==(d=l.hb_jwvb)?void 0:d.map((t=>encodeURIComponent(t))).join(","))||"",completion:(null==(h=y)||null==(c=h.hb_jwcr)?void 0:c.map((t=>encodeURIComponent(t))).join(","))||"",brandSafety:1===(null==(u=y)?void 0:u.hb_jwbs[0])?encodeURIComponent("Yes"):encodeURIComponent("No"),contextual:(null==(p=y)||null==(g=p.hb_jwiab)?void 0:g.map((t=>encodeURIComponent(t))).join(","))||""};-1!==e.indexOf(r)&&(a.jwpseg=m.jwpseg),e=Z(e,"__random-number__",Math.random()*Math.pow(10,18)),e=Z(e,"__timestamp__",(new Date).getTime()),e=Z(e,"__page-url__",encodeURIComponent(m.pageUrl||f.url)),e=Z(e,"__referrer__",encodeURIComponent(m.referrer||f.referrer)),e=Z(e,"__player-height__",m.playerHeight),e=Z(e,"__player-width__",m.playerWidth),e=Z(e,"__item-duration__",m.itemDuration),e=Z(e,"__integer-duration__",m.integerDuration),e=Z(e,r,m.jwpseg),e=Z(e,"__domain__",encodeURIComponent(m.domain||f.domain)),e=Z(e,"__placement__",m.placement),e=Z(e,"__device-ua__",encodeURIComponent(m.userAgent)),e=Z(e,"__jw-viewability__",_.viewability),e=Z(e,"__jw-completion__",_.completion),e=Z(e,"__jw-brand-safety__",_.brandSafety),e=Z(e,"__jw-contextual__",_.contextual),e=o.companion?Z(e,"__companion-div__",o.companion.id):Z(e,"__companion-div__","");const v=Object.keys(m).filter((t=>-1!==t.indexOf("item"))),w=v.map((t=>{const e=t.match(/item([\w]+?)(List)?$/);let s;return e&&(s=e[1].toLowerCase()),s}));let C=null;const T=/__item-([\w-]+?)(-list)?__/g,b=e;for(;null!==(C=T.exec(b));){const t=C[0],s=C[1],n=v[w.indexOf(s)];let r="";if(Q(i,s)&&"string"==typeof i[s]||n){r=n?m[n]:i[s];const t=!1===o.truncateMacros?4096:1e3;r.length>t&&(r=r.substring(0,t));const e=C[2]?",":null;r=r.split(e).map(encodeURIComponent)}e=Z(e,t,r)}if(n===t)return e;if("vast"===n){const t=s.getConfig().autostart?1:0,i=s.getMute()?1:0;e=function(t,e,s){return X.test(t)&&(t=`${t}&vpa=${e}&vpmute=${s}`),t}(e,t,i)}if("googima"===n&&i.title&&-1===e.indexOf("vid_t=")){const t=i.title.substring(0,100).replace(/[^\x00-\x7F]/g,"");e+=`${function(t){return-1!==t.indexOf("?")?"&":"?"}(e)}vid_t=${encodeURIComponent(t)}`}return-1!==e.indexOf("__gdpr__")||-1!==e.indexOf("__gdpr_consent__")||-1!==e.indexOf("__addtl_consent__")?function(t=1e3){return null===S&&(S=new Promise((t=>{const e=window.__tcfapi||L("__tcfapi");if(e)return e("getTCData",2,((e,s)=>{t(!1!==s?{gdprApplies:e.gdprApplies,consentData:e.tcString,addtlConsent:e.addtlConsent}:null)}));const s=window.__cmp||L("__cmp");if(s)return s("getConsentData",null,((e,s)=>{t(!1!==s?{gdprApplies:e.gdprApplies||e.isUserInEu,consentData:e.consentData}:null)}));const i=P();return t(i||{gdprApplies:!1,consentData:""})})).then((t=>(t&&(k=t),k)))),Promise.race([S,new Promise((e=>{setTimeout(e,t,k)}))])}().then((({gdprApplies:t,consentData:s,addtlConsent:i})=>(e=Z(e,"__gdpr__",t?1:0),e=Z(e,"__addtl_consent__",i||""),Z(e,"__gdpr_consent__",s||"")))).catch((()=>e)):Promise.resolve(e)},st=(t,e)=>{let s=R(t,e,!1);return s||(s="pre"),"number"==typeof s&&(s=(t=>{const e=parseInt(t,10);let s=Math.floor(e)%1e3,i=Math.floor(e/1e3)%60,n=Math.floor(e/6e4)%60,r=Math.floor(e/36e5)%24;return r=r<10?`0${r}`:r,n=n<10?`0${n}`:n,i=i<10?`0${i}`:i,s=`000${s}`.slice(-3),`${r}:${n}:${i}.${s}`})(1e3*s)),s};class it{constructor(t,e){this.player=t,this.options=e}getTagMap(e){const s=this.player,i=s.utils,n={},r=s.getPlaylistItem(s.getPlaylistItemIndex);return i.foreach(((t,e,s)=>{const i={};return e.foreach(t,(function(t,s){const n={};let r=s;s.ad&&(r=s.ad),n.offset=st(r.offset||r.position||s.offset||"",e),n.tag=r.tag,r.customadunitname&&(n.customadunitname=r.customadunitname),n.type=r.type||s.type||"linear,nonlinear",void 0!==r.skipoffset&&(n.skipoffset=r.skipoffset),i[t]=n})),i})(e,i,s._),((e,o)=>{let a=R(o.offset,i,!1);if(s._.isString(a)&&(a=parseFloat(a.replace("pre","0").replace("post","-1"))),s._.isNumber(a)){const e={tagName:et(o.tag,s,r,t,this.options),type:o.type};void 0!==o.skipoffset&&(e.skipoffset=o.skipoffset),o.customadunitname&&(e.customAdUnitName=o.customadunitname),n[a]=e}})),n}}var nt=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(t),e)};const rt={};class ot{constructor(t,e,s,i){this.responsePromise=null,this.streamType=s,this.sdk=i,this.adsManager=new this.sdk.AdManager,this.adsManager.setNetwork(e.networkid),this.adsManager.setServer(e.serverid),this.options=e||{},this.version=t,this.schedule=null,this.tagMap={},this._fwassetid=null,this._fwduration=0}open(t,e){const{sdk:s}=this,i=this.options;if(this.currentAdContext)throw new Error("Request already made");const n=i.getSchedule();if(!n)return this.responsePromise=Promise.reject(),this.responsePromise;if(this.currentAdContext=this.adsManager.newContext(),this.setContextSettings(this.currentAdContext),this._fwassetid=i.fwassetid,this._fwduration=i.duration,this.schedule=n,this.responsePromise=new Promise(((t,e)=>{this.currentAdContext.addEventListener(s.EVENT_REQUEST_COMPLETE,t),this.currentAdContext.addEventListener(s.EVENT_ERROR,e)})),"string"==typeof n)this.currentAdContext.addTemporalSlot(n,s.ADUNIT_PREROLL,0);else{const r=new it(t,e),o=this.tagMap=r.getTagMap(n),a=Object.keys(o);for(let t=0;t<a.length;t++){let e=parseFloat(a[t]);const n=o[e].tagName,r=o[e].customAdUnitName;let l=null;if("overlay"===o[e].type){if(-1===e)continue;l=s.ADUNIT_OVERLAY}if(!l)switch(e){case 0:l=r||s.ADUNIT_PREROLL;break;case-1:l=r||s.ADUNIT_POSTROLL,e=i.duration||1;break;default:l=r||s.ADUNIT_MIDROLL}this.currentAdContext.addTemporalSlot(n,l,e)}}return this.setCustomKeys(this.currentAdContext),this.responsePromise}setContextSettings(t){const{options:e}=this;t.setProfile(e.profileid),rt[e.sectionid]||(rt[e.sectionid]=Math.floor(2147483648*Math.random()));const s=rt[e.sectionid],i=e.sfid||null;t.setSiteSection(e.sectionid,null,s,null,i);const n=e.vcid||null;t.setVisitor(n,null)}setCustomKeys(t){const{custom:e}=this.options;let s=!1;for(const i in e)if(nt(e,i)){let n=e[i];n&&"string"!=typeof n&&(n=n.toString()),s||(t._adRequest._keyValues.push(""),s=!0),"_fw_gdpr"===i?this.adsManager._fwGDPR=e[i]:"_fw_gdpr_consent"===i?this.adsManager._fwGDPRConsent=n:t.addKeyValue(i,n)}}requestAds(t){const e=t.getContainer(),s=e.querySelector(".jw-wrapper");s.id=`${e.id}-jw-wrapper`,this.currentAdContext.registerVideoDisplayBase(s.id),this.setRequestSettings(this.currentAdContext,t),this.currentAdContext.submitRequest()}setRequestSettings(t,e){const{sdk:s}=this,i=e.getConfig();let n=s.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE;i.autostart&&(n=i.playOnViewable?s.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED:s.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED);const r=Math.floor(2147483648*Math.random()),o=this.options.afid||null;"LIVE"===i.streamType||this.streamType&&"LIVE"===this.streamType.toUpperCase()?(t.setVideoAsset(this._fwassetid,this._fwduration,null,null,n,r,null,o,s.VIDEO_ASSET_DURATION_TYPE_VARIABLE),t.setRequestMode(s.REQUEST_MODE_LIVE)):t.setVideoAsset(this._fwassetid,this._fwduration,null,null,n,r,null,o);const a=Math.floor(i.bandwidthEstimate/1e3);t.setParameter(s.PARAMETER_DESIRED_BITRATE,a,s.PARAMETER_LEVEL_OVERRIDE),t.setParameter(s.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED,!1,s.PARAMETER_LEVEL_GLOBAL),this.options.capabilities&&this.setCapabilities(t)}setCapabilities(t){const{options:e,sdk:s}=this,i=e.capabilities;if(i.flag)for(const e in i.flag)if(null!=e&&e.length){const n="on"===i.flag[e]?s.CAPABILITY_STATUS_ON:s.CAPABILITY_STATUS_OFF,r=s[e]?s[e]:e;t.setCapability(r,n)}i.metr}destroy(){this.responsePromise=null,this.adsManager.dispose()}}const at=(e,s,i,n=null)=>{const r={[i.TIME_POSITION_CLASS_PREROLL]:"pre",[i.TIME_POSITION_CLASS_MIDROLL]:"mid",[i.TIME_POSITION_CLASS_POSTROLL]:"post",[i.TIME_POSITION_CLASS_OVERLAY]:"overlay",[i.TIME_POSITION_CLASS_DISPLAY]:"display"};return{type:e,client:t,adposition:r[n]||D(s),viewable:s.getViewable()}};let lt=null,dt=!1;const ht=function(t,e){t.getContainer().querySelectorAll(".jw-icon-fullscreen").forEach((s=>{t.utils.style(s,{display:e})}))},ct=function(t){ht(t,"")},ut=t=>{t.stopPropagation()};class pt{constructor(t,e,s,i,n,r){s.utils.extend(this,s.Events),this.item=t,this.options=e,this.streamType=n,this.sdk=r,this.player=s,this.playerContainer=s.getContainer(),this.utils=s.utils,this.style=s.utils.style,this.environment=s.getEnvironment(),this.instreamProvider=i,this.initAdsManagerPromise=null,this.adsLoadedPromise=null,this.blockingInstreamPlayer=null,this.video=null,this.timeoutAdStart=-1,this.timeoutAdLoad=-1,this.adBlockTimeout=-1,this.progressIntervalId=-1,this.nonlinearContainerId=null,this.slots={prerolls:[],midrolls:[],postrolls:[]},this.playedMidrollIndex=[],this.mobileEventListeners={play:()=>this.adResume({reason:this.reason||"interaction"}),beginFullscreen:t=>this.startFullscreen(t),endFullscreen:t=>this.endFullscreen(t)},this.reason=null,this.playerEventListeners={"idle play pause beforeComplete":this.setVideoState},this.addPlayerListeners(),this._qoe=new s.utils.Timer,this.adStarted=this.adStarted.bind(this),this.adSlotComplete=this.adSlotComplete.bind(this),this.allAdEvent=this.allAdEvent.bind(this)}init(){this.initAdsManagerPromise=K(this.utils).then((()=>this.destroyed()?null:(this.sdk||(this.sdk=tv.freewheel.SDK),this.adsLoaderManager=new ot(this.player.version,this.options,this.streamType,this.sdk),this.player.trigger("adManager",{adManager:this.adsLoaderManager.adsManager}),this.player.trigger("adsManager",{adsManager:this.adsLoaderManager.adsManager}),this.adsLoaderManager))).catch((t=>this.asyncError(t))),this.adsLoadedPromise=this.initAdsManagerPromise.then((()=>this.adsLoaderManager.open(this.player,this.options))).then((e=>{if(this.destroyed())return null;const{sdk:s}=this;if(e.success){this.trigger("adRequest",{client:t,networkid:e.response.networkId});const i=this.adsLoaderManager.currentAdContext;this.instreamProvider.setProxy(i);const n=i.getTemporalSlots(),r=[];for(let t=0;t<n.length;t++){const e=n[t];switch(e.getTimePositionClass()){case s.TIME_POSITION_CLASS_PREROLL:this.slots.prerolls.push(e);break;case s.TIME_POSITION_CLASS_OVERLAY:this.slots.midrolls.push(e);break;case s.TIME_POSITION_CLASS_MIDROLL:this.slots.midrolls.push(e),r.push({begin:e.getTimePosition(),text:this.options.cuetext,cueType:"ads",adId:e.getCustomId()?e.getCustomId():null});break;case s.TIME_POSITION_CLASS_POSTROLL:this.slots.postrolls.push(e),r.push({begin:"post",text:this.options.cuetext,cueType:"ads",adId:e.getCustomId()?e.getCustomId():null})}}this.player.addCues(r),this.registerEvents(i),i.setParameter(s.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE,!1,s.PARAMETER_LEVEL_GLOBAL)}else this.asyncError(e);return this.slots.prerolls.length&&this.utils.addClass(this.playerContainer,g),e})).catch((t=>this.asyncError(t)))}registerEvents(t){const{sdk:e}=this;t.addEventListener(e.EVENT_SLOT_STARTED,this.adStarted),t.addEventListener(e.EVENT_SLOT_ENDED,this.adSlotComplete),t.addEventListener(e.EVENT_AD,this.allAdEvent)}startFullscreen(t){this.sendFullscreenEvent(t,!0)}endFullscreen(t){this.sendFullscreenEvent(t,!1)}sendFullscreenEvent(t,e){this.blockingInstreamPlayer&&this.blockingInstreamPlayer.trigger("fullscreenchange",{target:t.target,jwstate:e})}adErrorEventObject(e){const{sdk:s}=this;if(60003===e.adErrorCode)return e;const i=e.adInstance,n=tv?e[s.INFO_KEY_ERROR_INFO]:"FreeWheel SDK unavailable";return{id:i?i.getAdId():void 0,client:t,message:`Ad Error: ${n}`,code:e[s.INFO_KEY_ERROR_CODE],module:e[s.INFO_KEY_ERROR_MODULE]}}adEventObject(e){const s=this.currentSlot,i={client:t};if(s&&(i.tag=s.getCustomId()),!e&&s&&(e=s.getCurrentAdInstance()),!e)return i;const n=s.getTimePositionClass(),r="OVERLAY"===n,o=e.getActiveCreativeRendition();i.freewheel={ad:{adId:e.getAdId()}},i.adposition=n.toLowerCase().replace("roll",""),i.id=e.getAdId(),i.linear=r?"nonlinear":"linear",i.creativetype="static",i.viewable=this.player.getViewable(),r||(i.creativetype="VPAID"===o.getCreativeApi()?"vpaid-js":o.getContentType());const a=s.getAdCount();return a>1&&(i.sequence=s.getAdInstances().indexOf(e)+1,i.podcount=a),e.skipoffset&&(i.skipoffset=e.skipoffset),i}allAdEvent(t){const{sdk:s}=this,n=t.subType,r=t.adInstance,o=n===s.EVENT_AD_PAUSE?"paused":e;switch(n){case s.EVENT_AD_IMPRESSION:this.adImpression(t);break;case s.EVENT_AD_IMPRESSION_END:this.setTimeoutAdStart(t);break;case s.EVENT_AD_PAUSE:case s.EVENT_AD_RESUME:null===this.reason&&"VPAID"===r.getActiveCreativeRendition().getCreativeApi()&&(this.reason=i),this.setState(r,o);break;case s.EVENT_AD_COMPLETE:this.adComplete(t);break;case s.EVENT_AD_CLICK:this.adClick(t);break;case s.EVENT_ERROR:this.adError(t);break;case s.EVENT_AD_AUTO_PLAY_BLOCKED:this.pause({reason:"autostart"}),this.currentSlot&&(a=this.currentSlot.play,lt&&lt.OS.iOS&&dt&&(a(),dt=!1),this.instreamProvider.trigger("playAttemptFailed"))}var a}setupSkipButton(t){let e=this.options.config.skipoffset;const s="POSTROLL"===t.slot.getTimePositionClass()?-1:t.slot.getTimePosition(),i=this.adsLoaderManager.tagMap;if(i){const t=i[s];void 0!==(null==t?void 0:t.skipoffset)&&(e=t.skipoffset)}void 0!==e&&this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(u,this.skipAd,this),t.adInstance.skipoffset=e,this.blockingInstreamPlayer.setupSkipButton(e,this.options,this.utils.noop),this.blockingInstreamPlayer.on(u,this.skipAd,this))}adStarted(t){const e=t.slot.getTimePositionClass();e!==this.sdk.TIME_POSITION_CLASS_OVERLAY&&(this.player.trigger(h,at(h,this.player,this.sdk,e)),this.blockingInstreamPlayer.on("destroyed",(()=>{this.player.trigger(c,at(c,this.player,this.sdk,e))})))}adImpression(t){clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),clearTimeout(this.adBlockTimeout);const s=t.adInstance,i=this.adEventObject(s),n="VPAID"===s.getActiveCreativeRendition().getCreativeApi();if(this.utils.removeClass(this.playerContainer,m),this.utils.toggleClass(this.playerContainer,p,n),this.isPreroll(i)&&(this._qoe.tick("adImpression"),i.timeLoading=this._qoe.between("adLoading","adImpression")),this.updateAdPosition(s),this.progressInterval(this.currentSlot),this.setupSkipButton(t),this.setupNonlinearContainer(),this.resize(),this.trigger("adImpression",i),n&&this.trigger("adStarted",i),s.getCompanionAdInstances().length){const t=this.utils.extend({},i);t.companions=s.getCompanionAdInstances(),this.trigger("adCompanions",t)}this.setState(t.adInstance,e)}setTimeoutAdStart(){clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout((()=>{if(this.destroyed())return;const t=this.adEventObject();t.message="Ad Error: Creative timeout",this.trigger(d,t),this.currentSlot.skipCurrentAd()}),this.options.loadVideoTimeout)}setAdBlockTimeout(){this.player.getAdBlock()&&(clearTimeout(this.adBlockTimeout),this.adBlockTimeout=setTimeout((()=>{this.destroyed()||this.adError({id:void 0,client:t,message:"Ad playback blocked by an ad blocker",code:900,adErrorCode:60003})}),this.options.adBlockTimeout))}setVideoState({type:t}){var e;const{sdk:s}=this;if(null!=this&&null!=(e=this.adsLoaderManager)&&e.currentAdContext){const e={idle:s.VIDEO_STATE_STOPPED,play:s.VIDEO_STATE_PLAYING,pause:s.VIDEO_STATE_PAUSED,beforeComplete:s.VIDEO_STATE_COMPLETED};this.adsLoaderManager.currentAdContext.setVideoState(e[t])}}adResume({reason:t}){this.hasResumed||(this.reason=t,this.currentSlot.resume()),this.hasResumed=!1}skipAd(){const t=this.currentSlot;t.getCurrentAdInstance()&&(clearInterval(this.progressIntervalId),this.trigger(u,this.adEventObject()),t.skipCurrentAd()),ct(this.player)}stopAd(){const t=this.currentSlot;t&&(clearInterval(this.progressIntervalId),this.trigger(u,this.adEventObject()),t.stop())}adComplete(t){clearInterval(this.progressIntervalId),this.trigger("adComplete",this.adEventObject(t.adInstance))}adSlotComplete(t){const e=t.slot;e&&"POSTROLL"===e.getTimePositionClass()?setTimeout((()=>{this.stopBlocking(),this.nonlinearContainerId=null,this.destroy()}),0):(this.stopBlocking(),this.nonlinearContainerId=null)}adClick(t){this.trigger("adClick",this.adEventObject(t.adInstance)),this.pause({reason:"clickthrough"})}adError(t){this.options.debug&&console.error(t);const e=this.adErrorEventObject(t);900===e.code&&(this.timeoutAdStart=setTimeout((()=>this.destroy()),0));const s=t?t.adInstance:null;s&&this.isPreroll(this.adEventObject(s))&&(this._qoe.tick("adError"),e.timeLoading=this._qoe.between("adLoading","adError")),this.trigger(d,e)}updateAdPosition(t){this.instreamProvider&&this.instreamProvider.trigger(n,{position:Math.max(t.getPlayheadTime(),0),duration:t.getDuration()})}prepareToPlayAd(t){if(!this.destroyed())if(this.blockingInstreamPlayer){const e=t?"":this.options.loadingAd;this.blockingInstreamPlayer.setText(e)}else this.startBlocking(t)}playUnscheduledAd(t){const{sdk:e}=this;let s=this.adsLoaderManager.currentAdContext.getSlotByCustomId(t);if(s)return void this._skipAndPlayAd(s);const i=this.unscheduledAdContext=this.adsLoaderManager.adsManager.newContext();this.adsLoaderManager.setContextSettings(i),i.addTemporalSlot(t,e.ADUNIT_MIDROLL,this.player.getPosition()),this.adsLoaderManager.setCustomKeys(i),this.registerEvents(i),i.addEventListener(e.EVENT_ERROR,this.adError),i.addEventListener(e.EVENT_REQUEST_COMPLETE,(()=>{if(s=i.getSlotByCustomId(t),s)return void this._skipAndPlayAd(s);const e=this.adEventObject();e.message="Ad Error: No ads found.",this.trigger(d,e)})),this.adsLoaderManager.setRequestSettings(i,this.player),i.submitRequest()}_skipAndPlayAd(t){this.blockingInstreamPlayer&&this.skipAd(),this.playNextAd([t])}addMobileListeners(){Object.keys(this.mobileEventListeners).forEach((t=>{this.video.addEventListener(t,this.mobileEventListeners[t])}))}removeMobileListeners(){Object.keys(this.mobileEventListeners).forEach((t=>{this.video.removeEventListener(t,this.mobileEventListeners[t])}))}addPlayerListeners(){this.player.on(this.playerEventListeners,this)}removePlayerListeners(){this.player.off(this.playerEventListeners,this)}startBlocking(t){var e;if(this.blockingInstreamPlayer)return;!function(t){if(lt=t.getEnvironment(),!lt.OS.iOS||lt.Browser.version.major<10)return;const e=t.getContainer();e.requestFullscreen||e.webkitRequestFullscreen||(t.getFullscreen()&&(t.setFullscreen(!1),dt=!0),ht(t,"none"))}(this.player),this._qoe.tick("adLoading"),clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),clearTimeout(this.adBlockTimeout),this.timeoutAdLoad=setTimeout((()=>{if(this.destroyed())return;this.currentSlot&&this.currentSlot.stop();const t=this.adEventObject();t.message="Ad Error: Request timeout",this.trigger(d,t),this.stopBlocking()}),this.options.requestTimeout),this.utils.addClass(this.playerContainer,g),this.blockingInstreamPlayer=this.player.createInstream().init(),this.video=this.instreamProvider.video=this.blockingInstreamPlayer.getMediaElement(),this.video.addEventListener("mousedown",ut),this.video.addEventListener("pointerdown",ut),null==(e=this.unscheduledAdContext)||e.registerVideoDisplayBase(`${this.playerContainer.id}-jw-wrapper`),this.player.getPip()&&this.player.requestPip(this.video);const s=t?"":this.options.loadingAd;this.blockingInstreamPlayer.setText(s),this.blockingInstreamPlayer.applyProviderListeners(this.instreamProvider),this.environment.OS.mobile&&(this.removeMobileListeners(),this.addMobileListeners())}stopBlocking(){this.destroyed()||(clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),clearTimeout(this.adBlockTimeout),ct(this.player),this.utils.removeClass(this.playerContainer,[p,g,m]),this.environment.OS.mobile&&this.removeMobileListeners(),this.blockingInstreamPlayer&&(this.instreamProvider.off(),this.blockingInstreamPlayer.destroy(),this.blockingInstreamPlayer=null,this.video.removeEventListener("mousedown",ut),this.video.removeEventListener("pointerdown",ut),this.video=this.instreamProvider.video=null))}setupNonlinearContainer(){if(!this.nonlinearContainerId)return;const t=document.getElementById(this.nonlinearContainerId);this.utils.addClass(t,"jw-freewheel-nonlinear-container"),this.style(t,{top:"auto",height:"100%",width:"100%"})}beforePlay(t){this.reason=null!=t&&t.playReason?t.playReason:s;const e=!this.slots.prerolls.length;this.startBlocking(e),this.utils.addClass(this.playerContainer,m),this.initAdsManagerPromise.then((()=>{this.setAdBlockTimeout(),this.adsLoaderManager.requestAds(this.player)})),this.adsLoadedPromise.then((t=>{!this.destroyed()&&t.success&&this.playNextAd(this.slots.prerolls)})).catch((t=>this.asyncError(t)))}playNextAd(t){if(t.length){const e=this.currentSlot=t.shift();if("OVERLAY"!==e.getTimePositionClass()){const t=!e.getAdCount();this.prepareToPlayAd(t),this.nonlinearContainerId=null}else this.utils.addClass(this.playerContainer,g),this.nonlinearContainerId=`_fw_ad_container_html_${this.currentSlot.getCustomId()}_`;this.setTimeoutAdStart(),e.play(),"MIDROLL"===e.getTimePositionClass()&&this.setVideoState({type:"pause"})}else this.stopBlocking()}beforeComplete(){this.slots.postrolls.length&&this.playNextAd(this.slots.postrolls)}time(t){if(this.slots.midrolls.length){const e=this.getNextMidRollIndex(t.position);if(e>=0){const t=[this.slots.midrolls[e]];this.playNextAd(t)}}}progressInterval(t){if(clearInterval(this.progressIntervalId),!t)return;const e=t.getCurrentAdInstance(),s=t.getAdInstances().indexOf(e)+1,i=e.getDuration(),n=t.getAdCount();let r=-1;const o=this.options.admessage||"",a=this.options.admessagedynamickey,l=this.options.podmessage||"",d=new RegExp("__AD_POD_CURRENT__","g"),h=new RegExp("__AD_POD_LENGTH__","g");this.progressIntervalId=setInterval((()=>{const t=e.getPlayheadTime(),c=i-t;if(r!==c){if(r=c,this.blockingInstreamPlayer){let t,e=o.replace(a,`$1${Math.round(c)}$2`);n>1&&(t=l.replace(d,s),e=`${t.replace(h,n)}  ${e}`),this.blockingInstreamPlayer.setText(e)}if(i>0){const s=this.adEventObject(e);s.position=t,s.duration=i,this.trigger("adTime",s),this.updateAdPosition(e)}}}),250)}getNextMidRollIndex(t){let e=-1;if(this.playedMidrollIndex.length>=this.slots.midrolls.length)return e;for(let s=0;s<this.slots.midrolls.length;s++){if(!(this.slots.midrolls[s].getTimePosition()<=t))break;e=s}return this.playedMidrollIndex.indexOf(e)<0&&e>=0?(this.playedMidrollIndex.push(e),e):-1}setState(t,s){if(this.currentSlot.getTimePositionClass()===this.sdk.TIME_POSITION_CLASS_OVERLAY)return;const i=this.adEventObject(t);if(i.newstate=s,null!==this.reason){i[s===e?"playReason":"pauseReason"]=this.reason,this.reason=null}this.instreamProvider.trigger("state",i)}asyncError(t){this.destroyed()||(t&&this.adError(t),this.timeoutAdStart=setTimeout((()=>this.destroy()),0))}pause({reason:t}){this.currentSlot&&!this.video.paused&&(this.reason=t||s,this.currentSlot.pause())}resume({reason:t}){this.currentSlot&&this.video.paused&&(this.reason=t||s,this.currentSlot.resume(),this.hasResumed=!0)}resize(t,e){var s;const i=document.getElementById(this.nonlinearContainerId);if(i){const t=i.querySelector("iframe"),e=this.player.getSafeRegion(!0);this.style(t,{left:(e.width-t.offsetWidth)/2})}null!=this&&null!=(s=this.adsLoaderManager)&&s.currentAdContext&&t&&e&&this.adsLoaderManager.currentAdContext.resize(t,e)}destroy(){clearInterval(this.progressIntervalId),this.off(),this.destroyed()||(this.removePlayerListeners(),this.currentSlot&&this.currentSlot.stop(),this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(null,null,this),this.stopBlocking()),this.destroyAdContext(this.unscheduledAdContext),this.adsLoaderManager&&(this.adsLoaderManager.destroy(),this.destroyAdContext(this.adsLoaderManager.currentAdContext)),clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),clearTimeout(this.adBlockTimeout),this.nonlinearContainerId=null,this.item=null,this.options=null,this.player.off(null,null,this),this.player=null,this.instreamProvider.off(),this.instreamProvider.setProxy(null),this.instreamProvider=null,this.video=null,this.initAdsManagerPromise=null,this.adsLoadedPromise=null)}destroyAdContext(t){const{sdk:e}=this;t&&(t.removeEventListener(e.EVENT_SLOT_STARTED,this.adStarted),t.removeEventListener(e.EVENT_SLOT_ENDED,this.adSlotComplete),t.removeEventListener(e.EVENT_AD,this.allAdEvent),t.dispose())}destroyed(){return!this.item}isPreroll(t){return"pre"===t.adposition&&(void 0===t.podcount||0===t.sequence)}}!function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");e.setAttribute("media","screen"),e.innerHTML=t,document.head.appendChild(e)}}(".jwplayer.jw-flag-ads-freewheel.jw-flag-floating .jw-wrapper,.jwplayer.jw-flag-ads-freewheel.jw-freewheel-before-impression .jw-media video{pointer-events:none}.jwplayer.jw-flag-ads-freewheel.jw-flag-touch.jwplayer.jw-flag-ads-freewheel.jw-state-paused .jw-display-icon-container{display:none}.jwplayer.jw-flag-ads-freewheel.jw-flag-user-inactive.jw-state-playing .jw-freewheel-nonlinear-container{bottom:.5em}.jwplayer.jw-flag-ads-freewheel .jw-freewheel-nonlinear-container{bottom:3.5em;pointer-events:none}.jwplayer.jw-flag-ads-freewheel .jw-freewheel-nonlinear-container iframe{pointer-events:all}.jwplayer.jw-flag-ads-freewheel.jw-flag-time-slider-above .jw-freewheel-nonlinear-container{bottom:66px}"),function(t,e,s){try{(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(t,e,s)}catch(t){}}(t,"8.1",class extends y{constructor(e,s){super(e,s,null,t),this.resetSchedule=()=>{this.destroyAdsManager(),function(t){const e=t.getCues();if(Array.isArray(e)&&e.length){const s=e.filter((t=>"ads"!==t.cueType));t.setCues(s)}}(this.player)},this.rulesAllowAdPlayback=t=>{const e=t.getAdRules(),s=0===e.frequency&&1===this.playlistItemEventCount,i=this.playlistItemEventCount>=e.startOn&&(this.playlistItemEventCount-e.startOn)%e.frequency==0;return s||i},this.onAll=(t,e)=>{t===n?this.playlistItemManager.time(e):"beforeComplete"===t&&this.playlistItemManager.beforeComplete()},this.initAdsManager=(t,e)=>{const s=t.item,i=new B(this.pluginConfig||{},this.player.getConfig(),s);this.resetSchedule(),this.rulesAllowAdPlayback(i)?i.getSchedule()&&(this.playlistItemManager=new pt(s,i,this.player,this.instreamProvider,e,this.sdk||null),this.playlistItemManager.init(),this.playlistItemManager.on("all",((t,e)=>this.player.trigger(t,e))),this.player.once("beforePlay",(t=>this.playlistItemManager.beforePlay(t)),this.playlistItemManager).on("resize",(({width:t,height:e})=>this.playlistItemManager.resize(t,e)),this.playlistItemManager).on("fullscreen",(()=>this.playlistItemManager.resize()),this.playlistItemManager).on("all",this.onAll,this.playlistItemManager)):i.adschedule=null},this.playAd=t=>{t&&this.playlistItemManager&&this.playlistItemManager.playUnscheduledAd(t)},this.stopAd=()=>{this.playlistItemManager&&this.playlistItemManager.stopAd()},this.utils.extend(this,this.player.Events),this.instreamProvider=new H(this.utils,this.player.Events),this.adManagerURL=this.pluginConfig.freewheel?this.pluginConfig.freewheel.adManagerURL:null,this.playlistItemEventCount=0,this.version=J,K(this.utils,this.adManagerURL).then((()=>{this.sdk=tv.freewheel.SDK;const{sdk:t}=this;this.pluginConfig.debug?t.setLogLevel(t.LOG_LEVEL_DEBUG):t.setLogLevel(t.LOG_LEVEL_QUIET)})).catch(this.utils.noop),this.player.playAd=this.playAd,this.player.on("ready",(()=>{K(this.utils,this.adManagerURL).catch((()=>{this.handleDependencyError("Ad playback blocked by an ad blocker",2e4)})),this.entitlementsPromise.catch((t=>{this.handleDependencyError(`Ad Error: ${t.message}`,60002)}))})).on("playlistItem",(t=>{this.playlistItemEventCount++;const e=t.item.streamtype||this.playerConfig.streamtype;this.initAdsManager(t,e)})).on("playlistComplete",(()=>{this.resetSchedule()})).on("cast",(t=>{t.active&&this.resetSchedule()})).on("destroyPlugin",(()=>{this.destroy()})),this.entitlementsPromise=W(this.utils,this.playerKey,this.pluginConfig),this.entitlementsPromise.catch(this.utils.noop),this.destroy=this.destroyAdsManager}})}();
